<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AbaQuiz Admin{% endblock %}</title>
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/static/css/main.css">
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <!-- Alpine.js with Collapse plugin -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Theme management (must load before Alpine) -->
    <script src="/static/js/theme.js"></script>
</head>
<body class="min-h-screen" x-data="{ ...themeManager(), ...sidebarManager() }">
    <!-- Mobile menu button -->
    <button class="md:hidden fixed top-4 left-4 z-50 p-2 rounded-md bg-surface-primary border border-border-default shadow-md"
            @click="toggleMobile()"
            aria-label="Toggle menu">
        <svg class="w-5 h-5 text-text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path x-show="!mobileOpen" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            <path x-show="mobileOpen" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
    </button>

    <!-- Mobile overlay -->
    <div class="fixed inset-0 bg-black/50 z-30 md:hidden"
         x-show="mobileOpen"
         x-transition:enter="transition-opacity duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         @click="closeMobile()">
    </div>

    <!-- Sidebar -->
    <aside class="fixed left-0 top-0 h-screen z-40 bg-sidebar-bg border-r border-sidebar-border flex flex-col transition-all duration-200"
           :class="{
               'w-60': !collapsed,
               'w-16': collapsed,
               'translate-x-0': mobileOpen || window.innerWidth >= 768,
               '-translate-x-full': !mobileOpen && window.innerWidth < 768
           }"
           x-init="$watch('collapsed', () => $el.style.width = collapsed ? '64px' : '240px')">

        <!-- Header -->
        <div class="h-16 flex items-center px-4 border-b border-sidebar-border">
            <a href="/" class="flex items-center gap-2 text-text-primary hover:text-primary-600 transition-colors">
                <!-- Logo icon -->
                <svg class="w-7 h-7 text-primary-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                </svg>
                <span class="font-semibold text-lg" x-show="!collapsed" x-transition>AbaQuiz</span>
            </a>
            <!-- Collapse toggle (desktop only) -->
            <button class="ml-auto p-1.5 rounded-md text-text-muted hover:text-text-primary hover:bg-hover-overlay transition-colors hidden md:flex"
                    @click="toggleCollapse()"
                    :title="collapsed ? 'Expand sidebar' : 'Collapse sidebar'">
                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': collapsed }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"/>
                </svg>
            </button>
        </div>

        <!-- Navigation -->
        <nav class="flex-1 py-4 overflow-y-auto custom-scrollbar">
            <a href="/" class="nav-item {% if request.path == '/' %}active{% endif %}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                <span x-show="!collapsed" x-transition>Dashboard</span>
            </a>
            <a href="/questions" class="nav-item {% if request.path.startswith('/questions') %}active{% endif %}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span x-show="!collapsed" x-transition>Questions</span>
            </a>
            <a href="/tables" class="nav-item {% if request.path.startswith('/tables') %}active{% endif %}">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2 1 3 3 3h10c2 0 3-1 3-3V7c0-2-1-3-3-3H7C5 4 4 5 4 7zm0 5h16M9 4v16"/>
                </svg>
                <span x-show="!collapsed" x-transition>Tables</span>
            </a>
        </nav>

        <!-- Footer with theme toggle -->
        <div class="p-4 border-t border-sidebar-border">
            <button class="flex items-center justify-center w-full p-2 rounded-md text-text-secondary hover:text-text-primary hover:bg-hover-overlay transition-colors"
                    :class="{ 'justify-center': collapsed }"
                    @click="toggleTheme()"
                    :title="isDark ? 'Switch to light mode' : 'Switch to dark mode'">
                <!-- Sun icon (shown in dark mode) -->
                <svg x-show="isDark" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <!-- Moon icon (shown in light mode) -->
                <svg x-show="!isDark" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
                <span x-show="!collapsed" x-transition class="ml-2 text-sm">
                    <span x-text="isDark ? 'Light mode' : 'Dark mode'"></span>
                </span>
            </button>
        </div>
    </aside>

    <!-- Main content -->
    <main class="min-h-screen transition-all duration-200 bg-bg-base"
          :class="{
              'md:ml-60': !collapsed,
              'md:ml-16': collapsed
          }">
        <div class="max-w-content mx-auto px-4 sm:px-6 py-6 pt-16 md:pt-6">
            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer class="transition-all duration-200 border-t border-border-muted"
            :class="{
                'md:ml-60': !collapsed,
                'md:ml-16': collapsed
            }">
        <div class="max-w-content mx-auto px-4 sm:px-6 py-4">
            <p class="text-xs text-text-muted text-center">AbaQuiz Admin</p>
        </div>
    </footer>
</body>
</html>
